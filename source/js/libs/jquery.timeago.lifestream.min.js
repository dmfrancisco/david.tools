/**
 * Timeago is a jQuery plugin that makes it easy to support automatically
 * updating fuzzy timestamps (e.g. "4 minutes ago" or "about 1 day ago").
 *
 * @name timeago
 * @version 0.11.4
 * @requires jQuery v1.2.3+
 * @author Ryan McGeary
 * @license MIT License - http://www.opensource.org/licenses/mit-license.php
 *
 * For usage and examples, visit:
 * http://timeago.yarp.com/
 *
 * Copyright (c) 2008-2012, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
 */
/*!
 * jQuery Lifestream Plug-in
 * @version 0.3.1
 * Show a stream of your online activity
 *
 * Copyright 2011, Christian Vuerings - http://denbuzze.com
 */
(function(a){function c(){var b=d(this);if(!isNaN(b.datetime)){a(this).text(e(b.datetime))}return this}function d(c){c=a(c);if(!c.data("timeago")){c.data("timeago",{datetime:b.datetime(c)});var d=a.trim(c.text());if(d.length>0&&!(b.isTime(c)&&c.attr("title"))){c.attr("title",d)}}return c.data("timeago")}function e(a){return b.inWords(f(a))}function f(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){if(b instanceof Date){return e(b)}else if(typeof b==="string"){return e(a.timeago.parse(b))}else if(typeof b==="number"){return e(new Date(b))}else{return e(a.timeago.datetime(b))}};var b=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function k(d,e){var f=a.isFunction(d)?d(e,b):d;var g=c.numbers&&c.numbers[e]||e;return f.replace(/%d/i,g)}var c=this.settings.strings;var d=c.prefixAgo;var e=c.suffixAgo;if(this.settings.allowFuture){if(b<0){d=c.prefixFromNow;e=c.suffixFromNow}}var f=Math.abs(b)/1e3;var g=f/60;var h=g/60;var i=h/24;var j=i/365;var l=f<45&&k(c.seconds,Math.round(f))||f<90&&k(c.minute,1)||g<45&&k(c.minutes,Math.round(g))||g<90&&k(c.hour,1)||h<24&&k(c.hours,Math.round(h))||h<42&&k(c.day,1)||i<30&&k(c.days,Math.round(i))||i<45&&k(c.month,1)||i<365&&k(c.months,Math.round(i/30))||j<1.5&&k(c.year,1)||k(c.years,Math.round(j));var m=c.wordSeparator===undefined?" ":c.wordSeparator;return a.trim([d,l,e].join(m))},parse:function(b){var c=a.trim(b);c=c.replace(/\.\d+/,"");c=c.replace(/-/,"/").replace(/-/,"/");c=c.replace(/T/," ").replace(/Z/," UTC");c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(c)},datetime:function(c){var d=b.isTime(c)?a(c).attr("datetime"):a(c).attr("title");return b.parse(d)},isTime:function(b){return a(b).get(0).tagName.toLowerCase()==="time"}});a.fn.timeago=function(){var a=this;a.each(c);var d=b.settings;if(d.refreshMillis>0){setInterval(function(){a.each(c)},d.refreshMillis)}return a};document.createElement("abbr");document.createElement("time")})(jQuery);(function(a){"use strict";a.fn.lifestream=function(b){return this.each(function(){var c=a(this),d=jQuery.extend({classname:"lifestream",feedloaded:null,limit:10,defaultServiceLimit:50,serviceLimits:{},list:[]},b),e={count:d.list.length,items:[]},f=jQuery.extend(true,{},d),g=function(b){var f=0;if(b.length){var g=b[0].config.service;f=d.serviceLimits[g];if(!f){f=d.defaultServiceLimit}}var h=b.length<f?b.length:f;b.splice(h);a.merge(e.items,b);e.items.sort(function(a,b){return b.date-a.date});var i=e.items,j=i.length<d.limit?i.length:d.limit,k=0,l,m=a('<ul class="'+d.classname+'"/>');for(;k<j;k++){l=i[k];if(l.html){a('<li class="'+d.classname+"-"+l.config.service+'">').data("name",l.config.service).data("url",l.url||"#").data("time",l.date).append(l.html).appendTo(m)}}c.html(m);if(a.isFunction(d.feedloaded)){d.feedloaded()}},h=function(){var b=0,c=d.list.length;delete f.list;for(;b<c;b++){var e=d.list[b];if(a.fn.lifestream.feeds[e.service]&&a.isFunction(a.fn.lifestream.feeds[e.service])&&e.user){e._settings=f;a.fn.lifestream.feeds[e.service](e,g)}}};if(!jQuery.tmpl){jQuery.getScript("http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js",h)}else{h()}})};a.fn.lifestream.createYqlUrl=function(a){return("http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env="+"store://datatables.org/alltableswithkeys&format=json").replace("__QUERY__",encodeURIComponent(a))};a.fn.lifestream.feeds=a.fn.lifestream.feeds||{};if(!Object.keys){Object.keys=function(a){if(a!==Object(a)){throw new TypeError("Object.keys called on non-object")}var b=[],c;for(c in a){if(Object.prototype.hasOwnProperty.call(a,c)){b.push(c)}}return b}}})(jQuery);(function(a){a.fn.lifestream.feeds.dribbble=function(b,c){var d=a.extend({},{posted:'posted a shot <a href="${url}">${title}</a>'},b.template);a.ajax({url:"http://api.dribbble.com/players/"+b.user+"/shots",dataType:"jsonp",success:function(e){var f=[],g=0,h;if(e&&e.total){h=e.shots.length;for(;g<h;g++){var i=e.shots[g];f.push({date:new Date(i.created_at),config:b,html:a.tmpl(d.posted,i)})}}c(f)}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.forrst=function(b,c){var d=a.extend({},{posted:"posted a ${post_type} "+'<a href="${post_url}">${title}</a>'},b.template);a.ajax({url:"http://forrst.com/api/v2/users/posts?username="+b.user,dataType:"jsonp",success:function(e){var f=[],g=0,h;if(e&&e.resp.length&&e.resp.length>0){h=e.resp.length;for(;g<h;g++){var i=e.resp[g];f.push({date:new Date(i.created_at.replace(" ","T")),config:b,html:a.tmpl(d.posted,i)})}}c(f)}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.github=function(b,c){var d=a.extend({},{commitCommentEvent:'commented on <a href="http://github.com/'+'${status.repo.name}">${status.repo.name}</a>',createBranchEvent:'created branch <a href="http://github.com/'+'${status.repo.name}/tree/${status.payload.ref}">'+'${status.payload.ref}</a> at <a href="http://github.com/'+'${status.repo.name}">${status.repo.name}</a>',createRepositoryEvent:'created repository <a href="http://github.com/'+'${status.repo.name}">${status.repo.name}</a>',createTagEvent:'created tag <a href="http://github.com/'+'${status.repo.name}/tree/${status.payload.ref}">'+'${status.payload.ref}</a> at <a href="http://github.com/'+'${status.repo.name}">${status.repo.name}</a>',deleteBranchEvent:"deleted branch ${status.payload.ref} at "+'<a href="http://github.com/${status.repo.name}">'+"${status.repo.name}</a>",deleteTagEvent:"deleted tag ${status.payload.ref} at "+'<a href="http://github.com/${status.repo.name}">'+"${status.repo.name}</a>",followEvent:'started following <a href="http://github.com/'+'${status.payload.target.login}">${status.payload.target.login}</a>',forkEvent:'forked <a href="http://github.com/${status.repo.name}">'+"${status.repo.name}</a>",gistEvent:"${status.payload.action} gist "+'<a href="http://gist.github.com/${status.payload.gist.id}">'+"${status.payload.gist.id}</a>",issueCommentEvent:'commented on issue <a href="http://github.com/'+'${status.repo.name}/issues/${status.payload.issue.number}">'+'${status.payload.issue.number}</a> on <a href="http://github.com/'+'${status.repo.name}">${status.repo.name}</a>',issuesEvent:"${status.payload.action} issue "+'<a href="http://github.com/${status.repo.name}/issues/'+'${status.payload.issue.number}">${status.payload.issue.number}</a> '+'on <a href="http://github.com/${status.repo.name}">'+"${status.repo.name}</a>",pullRequestEvent:"${status.payload.action} pull request "+'<a href="http://github.com/${status.repo.name}/pull/'+'${status.payload.number}">${status.payload.number}</a> on '+'<a href="http://github.com/${status.repo.name}">'+"${status.repo.name}</a>",pushEvent:'pushed to <a href="http://github.com/${status.repo.name}'+'/tree/${status.payload.ref}">${status.payload.ref}</a> at '+'<a href="http://github.com/${status.repo.name}">'+"${status.repo.name}</a>",watchEvent:'started watching <a href="http://github.com/'+'${status.repo.name}">${status.repo.name}</a>'},b.template),e=function(b){if(b.type==="CommitCommentEvent"){return a.tmpl(d.commitCommentEvent,{status:b})}else if(b.type==="CreateEvent"&&b.payload.ref_type==="branch"){return a.tmpl(d.createBranchEvent,{status:b})}else if(b.type==="CreateEvent"&&b.payload.ref_type==="repository"){return a.tmpl(d.createRepositoryEvent,{status:b})}else if(b.type==="CreateEvent"&&b.payload.ref_type==="tag"){return a.tmpl(d.createTagEvent,{status:b})}else if(b.type==="DeleteEvent"&&b.payload.ref_type==="branch"){return a.tmpl(d.deleteBranchEvent,{status:b})}else if(b.type==="DeleteEvent"&&b.payload.ref_type==="tag"){return a.tmpl(d.deleteTagEvent,{status:b})}else if(b.type==="FollowEvent"){return a.tmpl(d.followEvent,{status:b})}else if(b.type==="ForkEvent"){return a.tmpl(d.forkEvent,{status:b})}else if(b.type==="GistEvent"){if(b.payload.action==="create"){b.payload.action="created"}else if(b.payload.action==="update"){b.payload.action="updated"}return a.tmpl(d.gistEvent,{status:b})}else if(b.type==="IssueCommentEvent"){return a.tmpl(d.issueCommentEvent,{status:b})}else if(b.type==="IssuesEvent"){return a.tmpl(d.issuesEvent,{status:b})}else if(b.type==="PullRequestEvent"){return a.tmpl(d.pullRequestEvent,{status:b})}else if(b.type==="PushEvent"){b.payload.ref=b.payload.ref.split("/")[2];return a.tmpl(d.pushEvent,{status:b})}else if(b.type==="WatchEvent"){return a.tmpl(d.watchEvent,{status:b})}},f=function(a){var c=[],d=0,f;if(a.query&&a.query.count&&a.query.count>0){f=a.query.count;for(;d<f;d++){var g=a.query.results.json[d].json;c.push({date:new Date(g.created_at),config:b,html:e(g),url:"https://github.com/"+b.user})}}return c};a.ajax({url:a.fn.lifestream.createYqlUrl("select "+"json.type, json.actor, json.repo, json.payload, json.created_at "+'from json where url="https://api.github.com/users/'+b.user+'/events/public?per_page=100"'),dataType:"jsonp",success:function(a){c(f(a))}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.googleplus=function(b,c){var d=a.extend({},{posted:'<a href="${actor.url}">${actor.displayName}</a> has posted a new entry <a href="${url}" '+'title="${id}">${title}</a> <!--With--> ${object.replies.totalItems} replies, ${object.plusoners.totalItems} +1s, ${object.resharers.totalItems} Reshares'},b.template),e=function(c){var e=[],f=0,g,h;if(c&&c.items){g=c.items.length;for(;f<g;f++){h=c.items[f];e.push({date:new Date(h.published),config:b,html:a.tmpl(d.posted,h)})}}return e};a.ajax({url:"https://www.googleapis.com/plus/v1/people/"+b.user+"/activities/public",data:{key:b.key},dataType:"jsonp",success:function(a){if(a.error){c([]);if(console&&console.error){console.error("Error loading Google+ stream.",a.error)}return}else{c(e(a))}}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.lastfm=function(b,c){var d=a.extend({},{loved:'loved <a href="${url}">${name}</a> by '+'<a href="${artist.url}">${artist.name}</a>'},b.template),e=function(c){var e=[],f,g=0,h;if(c.query&&c.query.count&&c.query.count>0&&c.query.results.lovedtracks&&c.query.results.lovedtracks.track){f=c.query.results.lovedtracks.track;h=f.length;for(;g<h;g++){var i=f[g],j=i.nowplaying?new Date:i.date.uts;e.push({date:new Date(parseInt(j*1e3,10)),config:b,html:a.tmpl(d.loved,i)})}}return e};a.ajax({url:a.fn.lifestream.createYqlUrl("select * from xml where url="+'"http://ws.audioscrobbler.com/2.0/user/'+b.user+'/lovedtracks.xml"'),dataType:"jsonp",success:function(a){c(e(a))}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.pinboard=function(b,c){var d=a.extend({},{bookmarked:'bookmarked <a href="${link}">${title}</a>'},b.template);var e=function(c){var e=[],f,g=0,h,i;if(c.query&&c.query.count&&c.query.count>0){f=c.query.results.RDF.item;h=f.length;for(;g<h;g++){i=f[g];e.push({date:new Date(i.date),config:b,html:a.tmpl(d.bookmarked,i)})}}return e};a.ajax({url:a.fn.lifestream.createYqlUrl("select * from xml where "+'url="http://feeds.pinboard.in/rss/u:'+b.user+'"'),dataType:"jsonp",success:function(a){c(e(a))}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.slideshare=function(b,c){var d=a.extend({},{uploaded:'uploaded a presentation <a href="${link}">${title}</a>'},b.template);var e=function(c){var e=[],f,g=0,h,i;if(c.query&&c.query.count&&c.query.count>0){f=c.query.results.rss.channel.item;h=f.length;for(;g<h;g++){i=f[g];e.push({date:new Date(i.pubDate),config:b,html:a.tmpl(d.uploaded,i)})}}return e};a.ajax({url:a.fn.lifestream.createYqlUrl("select * from xml where "+'url="http://www.slideshare.net/rss/user/'+b.user+'"'),dataType:"jsonp",success:function(a){c(e(a))}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.stackoverflow=function(b,c){var d=a.extend({},{global:'<a href="${link}">${text}</a> - ${title}'},b.template);var e=function(a){var c="",d="",e="",f="http://stackoverflow.com/users/"+b.user,g="http://stackoverflow.com/questions/";if(a.timeline_type==="badge"){c="was "+a.action+" the '"+a.description+"' badge";d=a.detail;e=f+"?tab=reputation"}else if(a.timeline_type==="comment"){c="commented on";d=a.description;e=g+a.post_id}else if(a.timeline_type==="revision"||a.timeline_type==="accepted"||a.timeline_type==="askoranswered"){c=a.timeline_type==="askoranswered"?a.action:a.action+" "+a.post_type;d=a.detail||a.description||"";e=g+a.post_id}return{link:e,title:d,text:c}},f=function(a){return new Date(a*1e3)};a.ajax({url:"http://api.stackoverflow.com/1.1/users/"+b.user+"/timeline?"+"jsonp",dataType:"jsonp",jsonp:"jsonp",success:function(g){var h=[],i=0,j;if(g&&g.total&&g.total>0&&g.user_timelines){j=g.user_timelines.length;for(;i<j;i++){var k=g.user_timelines[i];h.push({date:f(k.creation_date),config:b,html:a.tmpl(d.global,e(k))})}}c(h)}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.tumblr=function(b,c){var d=a.extend({},{posted:'posted a ${type} <a href="${url}">${title}</a>'},b.template),e=b.limit||20,f=function(b){switch(b.type){case"photo":var c=b["photo-url"];return a('<img width="75" height="75"/>').attr({src:c[c.length-1].content,title:i(b),alt:i(b)}).wrap("<div/>").parent().html();case"video":var d=b["video-player"];var e=d[d.length-1].content;if(e.match(/<\s*script/)){return null}return e;case"audio":return b["audio-player"]+" "+a("<div/>").text(i(b)).html();default:return null}},g=function(b,c){return a(b[c]).filter(":not(:empty):first").text()},h=function(a){var b;switch(a.type){case"regular":return a["regular-title"]||g(a,"regular-body");case"link":b=a["link-text"]||g(a,"link-description");if(b===""){b=a["link-url"]}return b;case"video":return g(a,"video-caption");case"audio":return g(a,"audio-caption");case"photo":return g(a,"photo-caption");case"quote":return'"'+a["quote-text"].replace(/<.+?>/g," ").trim()+'"';case"conversation":b=a["conversation-title"];if(!b){b=a["conversation"].line;if(typeof b!=="string"){b=line[0].label+" "+line[0].content+" ...."}}return b;case"answer":return a["question"];default:return a.type}},i=function(a){var b=h(a)||"";return b.replace(/<.+?>/gi," ")},j=function(b,c){return{date:new Date(c.date),config:b,html:a.tmpl(d.posted,{type:c.type.replace("regular","blog entry"),url:c.url,image:f(c),title:i(c)})}},k=function(c){var d=[],e=0,f,g;if(c.query&&c.query.count&&c.query.count>0){if(a.isArray(c.query.results.posts.post)){f=c.query.results.posts.post.length;for(;e<f;e++){g=c.query.results.posts.post[e];d.push(j(b,g))}}else if(a.isPlainObject(c.query.results.posts.post)){d.push(j(b,c.query.results.posts.post))}}return d};a.ajax({url:a.fn.lifestream.createYqlUrl("select *"+' from tumblr.posts where username="'+b.user+'" and num="'+e+'"'),dataType:"jsonp",success:function(a){c(k(a))}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.twitter=function(b,c){var d=a.extend({},{posted:"{{html tweet}}"},b.template),e=function(a){var b=function(a){return a.replace(/[a-z]+:\/\/[a-z0-9-_]+\.[a-z0-9-_:~%&\?\/.=]+[^:\.,\)\s*$]/ig,function(a){return'<a href="'+a+'">'+(a.length>25?a.substr(0,24)+"...":a)+"</a>"})},c=function(a){return a.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15})/g,function(a,b,c){return b+'<a href="http://twitter.com/'+c+'">@'+c+"</a>"})},d=function(a){return a.replace(/(^|[^\w'"]+)\#([a-zA-Z0-9_]+)/g,function(a,b,c){return b+'<a href="http://search.twitter.com/search?q=%23'+c+'">#'+c+"</a>"})};return d(c(b(a)))},f=function(c){var f=[],g=0,h,i;if(c&&c.length>0){h=c.length;for(;g<h;g++){i=c[g];f.push({date:new Date(i.created_at),config:b,html:a.tmpl(d.posted,{tweet:e(i.text),complete_url:"http://twitter.com/#!/"+b.user+"/status/"+i.id_str}),url:"http://twitter.com/#!/"+b.user})}}return f};a.ajax({url:"https://api.twitter.com/1/statuses/user_timeline.json",data:{screen_name:b.user,include_rts:1},dataType:"jsonp",success:function(a){c(f(a))}});return{template:d}}})(jQuery);(function(a){a.fn.lifestream.feeds.vimeo=function(b,c){var d=a.extend({},{posted:'posted <a href="${url}" title="${description}">${title}</a>'},b.template),e=function(c){var e=[],f=0,g,h;if(c){g=c.length;for(;f<g;f++){h=c[f];e.push({date:new Date(h.upload_date.replace(" ","T")),config:b,html:a.tmpl(d.posted,{url:h.url,description:h.description.replace(/"/g,"'").replace(/<.+?>/gi,""),title:h.title})})}}return e};a.ajax({url:"http://vimeo.com/api/v2/"+b.user+"/videos.json",dataType:"jsonp",crossDomain:true,success:function(a){c(e(a))}});return{template:d}}})(jQuery)
