// Since <link rel="prefetch" ...> was not working at the time,
// I followed this approach: http://www.memonic.com/user/pneff/id/1pCru
function prefetch() {
    var i = 0,
    // list of stuff to preload
    preload = [
        'annotations/somenotes.png',
        'annotations/click.png',
        'annotations/deinnovation.png',
        'annotations/external-link-activo.png',
        'annotations/external-link-old-activo.png',
        'annotations/facebook.png',
        'annotations/github.png',
        'annotations/lastfm.png',
        'annotations/linkedin.png',
        'annotations/somenotes.png',
        'annotations/twitter.png',
        'annotations/zootool.png'
    ],
    isIE = navigator.appName.indexOf('Microsoft') === 0;

    for (i = 0; i < preload.length; i += 1) {
        if (isIE) {
            new Image().src = preload[i];
            continue;
        }
        var o = document.createElement('object');
        o.data = preload[i];
        o.width  = 0;
        o.height = 0;

        // only FF appends to the head
        // all others require body
        document.body.appendChild(o);
    }
};

function mediaqueries() {
    if ($(window).width() < 680 && $('.more-projects').is(":visible")) {
        $('#more-projects-text-list').fadeIn('slow');
        $('.more-projects').hide();
        $('#soleio').hide();
        $('#projects').css('background', 'none');
    }
    else if ($(window).width() >= 680 && $('#more-projects-text-list').is(":visible")) {
        $('#more-projects-text-list').hide();
        $('.more-projects').fadeIn('slow');
        $('#soleio').show();
    }
}

$(document).ready(function() {
    /* Avoid pre-fetch in mobile devices, since annotations will not be visible */
    if ($('#is-mobile').css('display') != 'block') {
        prefetch();
    }
    $(window).resize(function() {
        mediaqueries();
    });

    var body = $('html, body');
    var profiles = $('#profiles');
    var projects = $('#projects');
    var showProfiles = $('#show-profiles');
    var showProjects = $('#show-projects');
    var showMoreProfiles = $('#show-more-profiles');
    var showMoreProjects = $('#show-more-projects');

    $('#projects-title, .projects, .more-projects').hide();
    $('#profiles-title, .profiles, .more-profiles').hide();
    $('.more-projects-no-js').hide();
    $('#soleio').hide();

    showProfiles.show();
    showProjects.show();
    showMoreProfiles.show();
    showMoreProjects.show();
    showProjects.click(function(e) {
        showProjects.hide();
        $('#projects-title').show();
        $('.projects').fadeIn('slow');
        body.animate({
            scrollTop: '490px'
        },
        800);
    });
    showProfiles.click(function(e) {
        showProfiles.hide();
        $('#profiles-title').show();
        $('.profiles').fadeIn('slow');
        body.animate({
            scrollTop: '300px'
        },
        800)
    });
    showMoreProfiles.click(function(e) {
        $('.more-profiles').fadeIn('slow');
        showMoreProfiles.hide();
        body.animate({
            scrollTop: '300px'
        },
        800)
    });
    showMoreProjects.click(function(e) {
        projects.css('background', 'url(annotations/click.png) no-repeat 380px 70px');
        $('.more-projects').fadeIn('slow');
        $('.projects').hide();
        showMoreProjects.hide();
        $('#soleio').show();
        body.animate({
            scrollTop: '490px'
        },
        800);
        mediaqueries();
    });
    $('.somenotes').mouseover(function() {
        profiles.css('background', 'url(annotations/somenotes.png) no-repeat 95px 25px')
    }).mouseout(function() {
        profiles.css('background', 'none')
    });
    $('.linkedin').mouseover(function() {
        profiles.css('background', 'url(annotations/linkedin.png) no-repeat 105px 25px')
    }).mouseout(function() {
        profiles.css('background', 'none')
    });
    $('.github').mouseover(function() {
        profiles.css('background', 'url(annotations/github.png) no-repeat 95px 45px')
    }).mouseout(function() {
        profiles.css('background', 'none')
    });
    $('.twitter').mouseover(function() {
        profiles.css('background', 'url(annotations/twitter.png) no-repeat 95px 35px')
    }).mouseout(function() {
        profiles.css('background', 'none')
    });
    $('.zootool').mouseover(function() {
        profiles.css('background', 'url(annotations/zootool.png) no-repeat 100px 65px')
    }).mouseout(function() {
        profiles.css('background', 'none')
    });
    $('.facebook').mouseover(function() {
        profiles.css('background', 'url(annotations/facebook.png) no-repeat 130px 145px')
    }).mouseout(function() {
        profiles.css('background', 'none')
    });
    $('.lastfm').mouseover(function() {
        profiles.css('background', 'url(annotations/lastfm.png) no-repeat 100px 65px')
    }).mouseout(function() {
        profiles.css('background', 'none')
    });
    $('#activo2').mouseover(function() {
        projects.css('background', 'url(annotations/external-link-activo.png) no-repeat 30px bottom')
    }).mouseout(function() {
        projects.css('background', 'none')
    });
    $('#activo').mouseover(function() {
        projects.css('background', 'url(annotations/external-link-old-activo.png) no-repeat 15px bottom')
    }).mouseout(function() {
        projects.css('background', 'none')
    });
    $('#deinnovation').mouseover(function() {
        projects.css('background', 'url(annotations/deinnovation.png) no-repeat 20px bottom')
    }).mouseout(function() {
        projects.css('background', 'none')
    });
    $("#about h1").lettering();
    $(document).ready(function() {
        $('#flip').jcoverflip({
            time: 200,
            current: 0,
            beforeCss: function(el, container, offset) {
                var offsetMod = offset;
                return [$.jcoverflip.animationElement(el, {
                    left: (410 - 10 * offset) + 'px',
                    bottom: '25px'
                },{
                    0: {
                        'z-index': offsetMod,
                        cursor: 'pointer'
                    }
                }), $.jcoverflip.animationElement(el.find('img'), {
                    width: '160px'
                }, {})]
            },
            afterCss: function(el, container, offset) {
                var offsetMod = (10 - offset);
                return [$.jcoverflip.animationElement(el, {
                    left: (330 + 10 * offset) + 'px',
                    bottom: '25px'
                },{
                    0: {
                        'z-index': offsetMod,
                        cursor: 'pointer'
                    }
                }), $.jcoverflip.animationElement(el.find('img'), {
                    width: '160px'
                }, {})]
            },
            currentCss: function(el, container) {
                return [$.jcoverflip.animationElement(el, {
                    left: '-5px',
                    bottom: '20px'
                },{
                    0: {
                        'z-index': '11',
                        cursor: 'default'
                    }
                }), $.jcoverflip.animationElement(el.find('img'), {
                    width: '320px'
                }, {})]
            }
        })
    })
});